<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïê RedM Rel√≥gio ‚Äì 20s real = 10 min jogo + Alarmes Lend√°rios</title>
    <style>
        body {
            background: linear-gradient(135deg, #0a001f, #2a0044);
            color: #e0f0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        h1, h2 { color: #aaffff; text-shadow: 0 0 15px #00ffff; margin: 10px 0; }
        .info { color: #aaa; font-size: 1.1em; margin: 10px 0 25px; }
        .section {
            background: rgba(0,0,0,0.5);
            border-radius: 16px;
            padding: 25px;
            margin: 20px auto;
            max-width: 960px;
            border: 1px solid #5555aa;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .time-big { 
            font-size: 5.2em; 
            color: #00ffff; 
            font-weight: bold; 
            letter-spacing: 6px; 
            text-shadow: 0 0 25px #00ffff; 
            margin: 15px 0; 
        }
        input[type="text"], input[type="time"] { 
            font-size: 1.6em; 
            padding: 10px 14px; 
            width: 140px; 
            text-align: center; 
            background: #1e1e3a; 
            border: 2px solid #6666ff; 
            border-radius: 10px; 
            color: #00ffff; 
        }
        button {
            font-size: 1.3em;
            padding: 12px 24px;
            margin: 8px 4px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s;
        }
        button.primary { background: #00aaff; color: white; }
        button.primary:hover { background: #0088cc; transform: scale(1.05); }
        button.add { background: #33cc66; color: white; }
        button.reset { background: #ff6666; color: white; }
        .bar { width: 100%; height: 28px; background: #222; border-radius: 14px; overflow: hidden; margin: 20px 0; box-shadow: inset 0 0 12px #000; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #ff3366, #ffff00, #33ff99); transition: width 0.7s; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 1.1em;
        }
        th, td { padding: 12px; border: 1px solid #444; }
        th { background: #2a2a55; }
        .delete-btn { background: #cc0000; color: white; padding: 6px 12px; font-size: 1em; }
        #status, #discordStatus { 
            font-size: 1.3em; 
            margin: 20px; 
            padding: 15px; 
            border-radius: 12px; 
            background: rgba(0,0,0,0.6); 
            min-height: 30px; 
        }
        .success { background: rgba(0,255,100,0.25); color: #88ffaa; }
        .error   { background: rgba(255,80,80,0.25); color: #ff8888; }
        #countdown { font-size: 2.6em; color: #ffdd44; font-weight: bold; margin: 20px 0; }
        #calcResult { display: none; font-size: 1.5em; margin-top: 25px; padding: 15px; background: rgba(0,200,0,0.15); border-radius: 12px; }
        .flash { animation: flash 1.2s infinite; }
        @keyframes flash { 0%,100% { background: rgba(255,80,80,0.3); } 50% { background: rgba(255,0,0,0.6); } }
    </style>
</head>
<body>
    <h1>üïê RedM Rel√≥gio + Alarmes Lend√°rios</h1>
    <div class="info">20 segundos reais = 10 minutos no jogo ‚Ä¢ 24h jogo = 48 minutos reais</div>

    <div class="section">
        <div>Hora atual no jogo:</div>
        <div class="time-big" id="gameTime">00:00</div>
        <div>Progresso do dia: <span id="prog">0.0</span>%</div>
        <div class="bar"><div id="barFill" class="bar-fill" style="width:0%"></div></div>

        <input type="text" id="editTime" value="01:42" placeholder="HH:MM">
        <button class="primary" id="applyEdit">Aplicar / Corrigir</button>
    </div>

    <div class="section">
        <h2>Calculadora ‚Äì Quando ser√° na vida real?</h2>
        <input type="text" id="targetTime" placeholder="Ex: 05:30">
        <button class="primary" id="calc">Calcular</button>

        <div id="calcResult">
            <div>Hora real aproximada: <span id="projReal">--:--:--</span></div>
            <div>Faltam: <span id="delta">-- min</span></div>
            <div id="countdown">00:00</div>
        </div>
    </div>

    <div class="section">
        <h2>ü¶å Alarmes ‚Äì Animais Lend√°rios</h2>
        
        <div style="margin: 15px 0;">
            <input type="text" id="newAnimalName" placeholder="Nome do animal" style="width: 240px;">
            <input type="time" id="newAnimalTime" value="12:00">
            <button class="add" id="addAlarm">+ Adicionar Alarme</button>
            <button class="reset" id="resetHunted">Resetar "Ca√ßados"</button>
        </div>

        <table id="alarmsTable">
            <thead>
                <tr>
                    <th>Animal Lend√°rio</th>
                    <th>Hora de Spawn (jogo)</th>
                    <th>Ca√ßado?</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="section">
        <h2>Discord Webhook (opcional)</h2>
        <input type="text" id="webhookUrl" placeholder="https://discord.com/api/webhooks/..." style="width:90%; max-width:620px; font-size:1.1em; margin-bottom:10px;">
        <br>
        <button class="discord" id="sendTest">Testar Envio</button>
        <button class="discord" id="toggleAuto">Iniciar Auto-Update (60s)</button>
        <div id="discordStatus" style="margin-top:15px; font-size:1.2em; min-height:28px;"></div>
    </div>

    <div id="status" class="success">Rel√≥gio iniciado ‚Ä¢ Nova escala: 20s real = 10 min jogo</div>

    <script>
        // CONFIGURA√á√ÉO DO TEMPO
        const CYCLE_MIN = 1440;                     // 24 horas = 1440 minutos
        const GAME_MIN_PER_REAL_SEC = 0.5;          // 20s real = 10 min jogo ‚Üí 1s real = 0.5 min jogo

        let startRealSec = Date.now() / 1000;
        let startGameMin = 1 * 60 + 42;             // Come√ßa em 01:42 ‚Äì altera aqui se quiser

        let autoUpdateId = null;
        let countdownId = null;
        let animals = [];

        function pad(n) { return String(Math.floor(n)).padStart(2, '0'); }

        function timeToMinutes(str) {
            if (!str) return -1;
            const [h, m] = str.split(':').map(Number);
            if (isNaN(h) || isNaN(m)) return -1;
            return h * 60 + m;
        }

        function updateClock() {
            const now = Date.now() / 1000;
            const elapsedRealSec = now - startRealSec;
            const gameMinTotal = (startGameMin + elapsedRealSec * GAME_MIN_PER_REAL_SEC) % CYCLE_MIN;

            const h = Math.floor(gameMinTotal / 60);
            const m = Math.floor(gameMinTotal % 60);
            document.getElementById('gameTime').textContent = `${pad(h)}:${pad(m)}`;

            const progress = ((gameMinTotal / CYCLE_MIN) * 100).toFixed(1);
            document.getElementById('prog').textContent = progress;
            document.getElementById('barFill').style.width = `${progress}%`;

            checkAlarms(gameMinTotal);

            if (autoUpdateId) sendDiscordUpdate(`${pad(h)}:${pad(m)} | ${progress}%`);
        }

        function applyEdit() {
            const val = document.getElementById('editTime').value.trim();
            const match = val.match(/^(\d{1,2}):(\d{2})$/);
            if (!match) return showStatus('Formato inv√°lido. Use HH:MM', 'error');

            const hh = parseInt(match[1]);
            const mm = parseInt(match[2]);
            if (hh > 23 || mm > 59) return showStatus('Hora inv√°lida (00:00‚Äì23:59)', 'error');

            const newGameMin = hh * 60 + mm;
            const now = Date.now() / 1000;
            const elapsed = now - startRealSec;
            startGameMin = (newGameMin - elapsed * GAME_MIN_PER_REAL_SEC + CYCLE_MIN) % CYCLE_MIN;

            showStatus(`Hora ajustada para ${val}`, 'success');
            updateClock();
        }

        function calculateFuture() {
            const val = document.getElementById('targetTime').value.trim();
            const match = val.match(/^(\d{1,2}):(\d{2})$/);
            if (!match) return showStatus('Alvo inv√°lido. Use HH:MM', 'error');

            const th = parseInt(match[1]);
            const tm = parseInt(match[2]);
            const targetMin = (th * 60 + tm + CYCLE_MIN) % CYCLE_MIN;

            const now = Date.now() / 1000;
            const elapsed = now - startRealSec;
            const curGameMin = (startGameMin + elapsed * GAME_MIN_PER_REAL_SEC) % CYCLE_MIN;

            let deltaGameMin = (targetMin - curGameMin + CYCLE_MIN) % CYCLE_MIN;
            const deltaRealSec = deltaGameMin / GAME_MIN_PER_REAL_SEC;

            const projTime = new Date(now * 1000 + deltaRealSec * 1000);
            document.getElementById('projReal').textContent = projTime.toLocaleTimeString('pt-BR', {hour12:false});
            document.getElementById('delta').textContent = `${Math.floor(deltaGameMin)} min (${Math.round(deltaRealSec)}s)`;

            document.getElementById('calcResult').style.display = 'block';

            if (countdownId) clearInterval(countdownId);
            const cdStart = now;
            countdownId = setInterval(() => {
                const rem = Math.max(0, deltaRealSec - (Date.now()/1000 - cdStart));
                const rm = Math.floor(rem / 60);
                const rs = Math.floor(rem % 60);
                document.getElementById('countdown').textContent = rem > 0 ? `${pad(rm)}:${pad(rs)}` : 'üö® AGORA!';
                if (rem <= 0) clearInterval(countdownId);
            }, 980);
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ALARMES LEND√ÅRIOS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function loadAnimals() {
            try {
                const saved = localStorage.getItem('redmLendarios');
                if (saved) animals = JSON.parse(saved);
            } catch (e) {}
            if (!animals.length) {
                animals = [
                    {name: "Urso Bharati", time: "02:15", hunted: false},
                    {name: "Lobo Lend√°rio", time: "04:45", hunted: false},
                    {name: "Alce Lend√°rio", time: "07:30", hunted: false},
                    {name: "Pantera Lend√°ria", time: "23:10", hunted: false}
                ];
            }
            renderAlarmsTable();
        }

        function saveAnimals() {
            try { localStorage.setItem('redmLendarios', JSON.stringify(animals)); } catch (e) {}
        }

        function renderAlarmsTable() {
            const tbody = document.querySelector('#alarmsTable tbody');
            tbody.innerHTML = '';
            animals.forEach((animal, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${animal.name}" onchange="animals[${index}].name = this.value; saveAnimals();"></td>
                    <td><input type="time" value="${animal.time}" onchange="animals[${index}].time = this.value; saveAnimals();"></td>
                    <td><input type="checkbox" ${animal.hunted ? 'checked' : ''} onchange="animals[${index}].hunted = this.checked; saveAnimals();"></td>
                    <td><button class="delete-btn" onclick="animals.splice(${index},1); saveAnimals(); renderAlarmsTable();">X</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function addAlarm() {
            const name = document.getElementById('newAnimalName').value.trim();
            const time = document.getElementById('newAnimalTime').value;
            if (!name || !time) return showStatus('Preenche nome e hora!', 'error');

            animals.push({name, time, hunted: false});
            saveAnimals();
            renderAlarmsTable();
            document.getElementById('newAnimalName').value = '';
            showStatus(`Alarme adicionado: ${name} √†s ${time}`, 'success');
        }

        function checkAlarms(currentGameMin) {
            const floorMin = Math.floor(currentGameMin);
            animals.forEach(animal => {
                if (animal.hunted) return;
                const alarmMin = timeToMinutes(animal.time);
                if (alarmMin >= 0 && floorMin === alarmMin) {
                    triggerAlarm(animal);
                }
            });
        }

        function triggerAlarm(animal) {
            playBeep();
            document.body.classList.add('flash');
            setTimeout(() => document.body.classList.remove('flash'), 4000);

            if (Notification.permission === 'granted') {
                new Notification(`ü¶å ${animal.name} dispon√≠vel!`, {
                    body: `Hora no jogo: ${animal.time}`,
                    icon: 'https://via.placeholder.com/192?text=ü¶å'
                });
            }
            showStatus(`ALERTA: ${animal.name} spawnou! (${animal.time})`, 'success');
        }

        function playBeep() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.18);
            setTimeout(() => {
                const osc2 = ctx.createOscillator();
                osc2.frequency.setValueAtTime(1100, ctx.currentTime);
                osc2.connect(ctx.destination);
                osc2.start();
                osc2.stop(ctx.currentTime + 0.18);
            }, 220);
        }

        async function sendDiscordUpdate(text) {
            const url = document.getElementById('webhookUrl').value.trim();
            if (!url) return;
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [{
                            title: "üïê Hora Atual no RedM",
                            description: text,
                            color: 0x00ffff,
                            timestamp: new Date().toISOString(),
                            footer: { text: "20s real = 10 min jogo ‚Ä¢ Alarmes ativos" }
                        }]
                    })
                });
                if (res.ok) {
                    document.getElementById('discordStatus').textContent = 'Enviado ‚úì';
                    document.getElementById('discordStatus').style.color = '#88ffaa';
                }
            } catch (err) {
                document.getElementById('discordStatus').textContent = 'Erro: ' + err.message;
                document.getElementById('discordStatus').style.color = '#ff8888';
            }
        }

        function showStatus(msg, type) {
            const el = document.getElementById('status');
            el.textContent = msg;
            el.className = type;
        }

        // Eventos
        document.getElementById('applyEdit').onclick = applyEdit;
        document.getElementById('editTime').onkeypress = e => { if (e.key === 'Enter') applyEdit(); };

        document.getElementById('calc').onclick = calculateFuture;
        document.getElementById('targetTime').onkeypress = e => { if (e.key === 'Enter') calculateFuture(); };

        document.getElementById('addAlarm').onclick = addAlarm;
        document.getElementById('resetHunted').onclick = () => {
            animals.forEach(a => a.hunted = false);
            saveAnimals();
            renderAlarmsTable();
            showStatus('Todos os ca√ßados resetados', 'success');
        };

        document.getElementById('sendTest').onclick = () => {
            const t = document.getElementById('gameTime').textContent;
            const p = document.getElementById('prog').textContent;
            sendDiscordUpdate(`Teste: ${t} | Progresso: ${p}%`);
        };

        document.getElementById('toggleAuto').onclick = function() {
            if (autoUpdateId) {
                clearInterval(autoUpdateId);
                autoUpdateId = null;
                this.textContent = 'Iniciar Auto-Update (60s)';
                showStatus('Auto-update parado', 'error');
            } else {
                autoUpdateId = setInterval(updateClock, 60000);
                this.textContent = 'Parar Auto-Update';
                showStatus('Auto-update iniciado ‚Äì envia para Discord a cada 60s', 'success');
            }
            updateClock();
        };

        // In√≠cio
        loadAnimals();
        Notification.requestPermission();
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>